#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Фінальне полірування units_l_english.yml
Виправлення всіх залишків російської мови
"""

import re

# Додаткові виправлення для складних випадків
FIXES = {
    # Російські закінчення іменників
    'гастатов': 'гастатів',
    'эквитов': 'еквітів',
    'баллистариев': 'балістаріїв',
    'ауксилариев': 'ауксиліїв',
    'катафрактарии': 'катафрактарії',
    'Катафрактарии': 'Катафрактарії',

    # Російські слова що залишились
    'Ранняя': 'Рання',
    'ранняя': 'рання',
    'Раннее': 'Раннє',
    'раннее': 'раннє',
    'Ранние': 'Ранні',
    'ранние': 'ранні',
    'Ранний': 'Ранній',
    'ранний': 'ранній',
    'поздний': 'пізній',
    'поздняя': 'пізня',
    'позднее': 'пізнє',
    'поздние': 'пізні',
    'Поздний': 'Пізній',
    'Поздняя': 'Пізня',
    'Позднее': 'Пізнє',
    'Поздние': 'Пізні',

    'Реформированный': 'Реформований',
    'Реформированная': 'Реформована',
    'Реформированное': 'Реформоване',
    'Реформированные': 'Реформовані',
    'реформированный': 'реформований',
    'реформированная': 'реформована',
    'реформированное': 'реформоване',
    'реформированные': 'реформовані',

    # Ще дієслова
    'вооружённый': 'озброєний',
    'вооружённая': 'озброєна',
    'вооружённое': 'озброєне',
    'вооружённые': 'озброєні',
    'закованный': 'закутий',
    'закованная': 'закута',
    'закованное': 'закуте',
    'закованные': 'закуті',
    'оснащённый': 'оснащений',
    'оснащённая': 'оснащена',
    'оснащённое': 'оснащене',
    'оснащённые': 'оснащені',
    'экипированный': 'екіпірований',
    'экипированная': 'екіпірована',
    'экипированное': 'екіпіроване',
    'экипированные': 'екіпіровані',
    'облачённый': 'одягнений',
    'облачённая': 'одягнена',
    'облачённое': 'одягнене',
    'облачённые': 'одягнені',

    # Складні слова
    'предназначенный': 'призначений',
    'предназначенная': 'призначена',
    'предназначенное': 'призначене',
    'предназначенные': 'призначені',
    'приспособленный': 'пристосований',
    'приспособленная': 'пристосована',
    'приспособленное': 'пристосоване',
    'приспособленные': 'пристосовані',

    # Прийменники
    'благодаря': 'завдяки',
    'согласно': 'згідно з',
    'вследствие': 'внаслідок',
    'ввиду': 'зважаючи на',
    'несмотря': 'незважаючи',

    # Інше
    'особенно': 'особливо',
    'обычно': 'зазвичай',
    'преимущественно': 'переважно',
    'исключительно': 'виключно',
    'главным': 'головним',
    'основным': 'основним',
    'единственный': 'єдиний',
    'единственная': 'єдина',
    'единственное': 'єдине',
    'единственные': 'єдині',
    'множественный': 'численний',
    'множественная': 'численна',
    'множественное': 'численне',
    'множественные': 'численні',
    'многочисленный': 'численний',
    'многочисленная': 'численна',
    'многочисленное': 'численне',
    'многочисленные': 'численні',

    # Дієслова що залишились
    'пришедший': 'який прийшов',
    'пришедшие': 'які прийшли',
    'ставший': 'який став',
    'ставшая': 'яка стала',
    'ставшее': 'яке стало',
    'ставшие': 'які стали',
    'получивший': 'який отримав',
    'получившая': 'яка отримала',
    'получившее': 'яке отримало',
    'получившие': 'які отримали',

    # Складні конструкції
    'в качестве': 'як',
    'в течение': 'протягом',
    'в отличие': 'на відміну',
    'в результате': 'внаслідок',
    'в случае': 'у разі',
    'в состоянии': 'у стані',
    'в связи': "у зв'язку",
    'в силу': 'через',
    'в ходе': 'під час',
    'в частности': 'зокрема',
    'в целом': 'загалом',
    'в основном': 'в основному',
    'в первую очередь': 'насамперед',
    'в том числе': 'в тому числі',
    'в зависимости': 'залежно',
}

def apply_fixes(text):
    """Застосувати всі виправлення"""
    for ru, ua in FIXES.items():
        # Заміна цілих слів/фраз
        text = re.sub(r'\b' + re.escape(ru) + r'\b', ua, text)
    return text

def process_file():
    """Обробити файл"""
    filepath = "/Users/furmonenko/Desktop/eu5-ukrainian-localization/main_menu/localization/english/units_l_english.yml"

    print("Фінальне полірування units_l_english.yml...")
    print("=" * 80)

    with open(filepath, 'r', encoding='utf-8-sig') as f:
        lines = f.readlines()

    new_lines = []
    fixes_count = 0

    for i, line in enumerate(lines, 1):
        if line.strip().startswith('#') or not line.strip() or i == 1:
            new_lines.append(line)
            continue

        # Шукаємо рядки з текстом
        match = re.match(r'^(\s*)([^:]+):\s*"(.+)"(.*)$', line.rstrip())
        if match:
            indent, key, text, suffix = match.groups()
            original_text = text
            text = apply_fixes(text)

            if text != original_text:
                fixes_count += 1

            new_lines.append(f'{indent}{key}: "{text}"{suffix}\n')
        else:
            new_lines.append(line)

        if i % 200 == 0:
            print(f"  Оброблено {i}/{len(lines)} рядків...")

    # Зберігаємо
    with open(filepath, 'w', encoding='utf-8-sig') as f:
        f.writelines(new_lines)

    print("=" * 80)
    print(f"✓ Фінальне полірування завершено!")
    print(f"  Виправлено додатково: {fixes_count} рядків")

if __name__ == "__main__":
    process_file()
