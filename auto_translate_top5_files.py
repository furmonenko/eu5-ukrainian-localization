#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Автоматизований переклад топ-5 файлів з російської на українську
З правильними відмінками та форматом Concept()
"""

import os
import re
from pathlib import Path

# Великий російсько-український словник
TRANSLATION_DICT = {
    # Базові слова
    'страна': 'держава',
    'страны': 'держави',
    'стране': 'державі',
    'страну': 'державу',
    'страной': 'державою',
    'стран': 'держав',
    'странами': 'державами',

    'война': 'війна',
    'войны': 'війни',
    'войну': 'війну',
    'войне': 'війні',
    'войной': 'війною',
    'войн': 'воєн',

    'мир': 'мир',
    'мира': 'миру',
    'миру': 'миру',
    'мире': 'мирі',

    'армия': 'армія',
    'армии': 'армії',
    'армию': 'армію',
    'армией': 'армією',
    'армий': 'армій',

    'провинция': 'провінція',
    'провинции': 'провінції',
    'провинцию': 'провінцію',
    'провинций': 'провінцій',

    'населения': 'населення',
    'населению': 'населенню',
    'населением': 'населенням',

    'религия': 'віра',
    'религии': 'віри',
    'религию': 'віру',
    'религией': 'вірою',
    'религий': 'вір',

    'культура': 'культура',
    'культуры': 'культури',
    'культуру': 'культуру',
    'культурой': 'культурою',
    'культур': 'культур',

    'рынок': 'ринок',
    'рынка': 'ринку',
    'рынку': 'ринку',
    'рынком': 'ринком',
    'рынки': 'ринки',
    'рынков': 'ринків',

    'правитель': 'правитель',
    'правителя': 'правителя',
    'правителю': 'правителю',
    'правителем': 'правителем',
    'правители': 'правителі',
    'правителей': 'правителів',

    'персонаж': 'персонаж',
    'персонажа': 'персонажа',
    'персонажу': 'персонажу',
    'персонажем': 'персонажем',
    'персонажи': 'персонажі',
    'персонажей': 'персонажів',

    'вассал': 'васал',
    'вассала': 'васала',
    'вассалу': 'васалу',
    'вассалом': 'васалом',
    'вассалы': 'васали',
    'вассалов': 'васалів',

    'сюзерен': 'сюзерен',
    'сюзерена': 'сюзерена',
    'сюзерену': 'сюзерену',
    'сюзереном': 'сюзереном',
    'сюзерены': 'сюзерени',

    'столица': 'столиця',
    'столицы': 'столиці',
    'столицу': 'столицю',
    'столицей': 'столицею',

    'еда': 'їжа',
    'еды': 'їжі',
    'еду': 'їжу',
    'едой': 'їжею',

    'торговля': 'торгівля',
    'торговли': 'торгівлі',
    'торговлю': 'торгівлю',
    'торговлей': 'торгівлею',

    'купец': 'купець',
    'купца': 'купця',
    'купцу': 'купцю',
    'купцом': 'купцем',
    'купцы': 'купці',
    'купцов': 'купців',

    'здание': 'будівля',
    'здания': 'будівлі',
    'зданию': 'будівлі',
    'зданием': 'будівлею',
    'зданий': 'будівель',

    'золото': 'золото',
    'золота': 'золота',
    'золоту': 'золоту',
    'золотом': 'золотом',

    'корабль': 'корабель',
    'корабля': 'корабля',
    'кораблю': 'кораблю',
    'кораблем': 'кораблем',
    'корабли': 'кораблі',
    'кораблей': 'кораблів',

    'флот': 'флот',
    'флота': 'флоту',
    'флоту': 'флоту',
    'флотом': 'флотом',
    'флоты': 'флоти',
    'флотов': 'флотів',

    # Слова та фрази
    'если': 'якщо',
    'когда': 'коли',
    'это': 'це',
    'этот': 'цей',
    'эта': 'ця',
    'это': 'це',
    'эти': 'ці',
    'этого': 'цього',
    'этой': 'цієї',
    'этому': 'цьому',
    'этим': 'цим',

    'который': 'який',
    'которая': 'яка',
    'которое': 'яке',
    'которые': 'які',
    'которого': 'якого',
    'которой': 'якої',
    'которому': 'якому',
    'которым': 'яким',
    'которых': 'яких',

    'наш': 'наш',
    'наша': 'наша',
    'наше': 'наше',
    'наши': 'наші',
    'нашего': 'нашого',
    'нашей': 'нашої',
    'нашему': 'нашому',
    'нашим': 'нашим',
    'наших': 'наших',

    'все': 'всі',
    'всех': 'всіх',
    'всем': 'всім',
    'всеми': 'всіма',

    'или': 'або',
    'и': 'і',
    'но': 'але',
    'что': 'що',
    'чтобы': 'щоб',
    'как': 'як',

    'больше': 'більше',
    'меньше': 'менше',
    'много': 'багато',
    'мало': 'мало',

    'можно': 'можна',
    'нельзя': 'не можна',
    'нужно': 'потрібно',
    'должен': 'повинен',
    'должна': 'повинна',
    'должны': 'повинні',

    'имеет': 'має',
    'имеют': 'мають',
    'получает': 'отримує',
    'получают': 'отримують',
    'получить': 'отримати',

    'дает': 'дає',
    'дают': 'дають',
    'дать': 'дати',

    'будет': 'буде',
    'будут': 'будуть',

    'является': 'є',
    'являются': 'є',

    'находится': 'знаходиться',
    'находятся': 'знаходяться',

    'становится': 'стає',
    'становятся': 'стають',

    'может': 'може',
    'могут': 'можуть',

    'хочет': 'хоче',
    'хотят': 'хочуть',
    'хотеть': 'хотіти',

    # Числа
    'один': 'один',
    'одна': 'одна',
    'одно': 'одне',
    'одного': 'одного',
    'одной': 'однієї',
    'одному': 'одному',

    'два': 'два',
    'две': 'дві',
    'двух': 'двох',
    'двум': 'двом',
    'двумя': 'двома',

    'три': 'три',
    'трех': 'трьох',
    'трем': 'трьом',
    'тремя': 'трьома',

    'четыре': 'чотири',
    'четырех': 'чотирьох',

    'пять': 'п\'ять',
    'пяти': 'п\'яти',
    'пятью': 'п\'ятьма',

    # Прикметники
    'новый': 'новий',
    'новая': 'нова',
    'новое': 'нове',
    'новые': 'нові',
    'нового': 'нового',
    'новой': 'нової',
    'новому': 'новому',
    'новым': 'новим',
    'новых': 'нових',

    'старый': 'старий',
    'старая': 'стара',
    'старое': 'старе',
    'старые': 'старі',

    'большой': 'великий',
    'большая': 'велика',
    'большое': 'велике',
    'большие': 'великі',

    'маленький': 'малий',
    'маленькая': 'мала',
    'маленькое': 'мале',
    'маленькие': 'малі',

    'хороший': 'гарний',
    'хорошая': 'гарна',
    'хорошее': 'гарне',
    'хорошие': 'гарні',

    'плохой': 'поганий',
    'плохая': 'погана',
    'плохое': 'погане',
    'плохие': 'погані',

    'важный': 'важливий',
    'важная': 'важлива',
    'важное': 'важливе',
    'важные': 'важливі',

    # Дієслова
    'атаковать': 'атакувати',
    'атакует': 'атакує',
    'атакуют': 'атакують',

    'захватить': 'захопити',
    'захватывает': 'захоплює',
    'захватывают': 'захоплюють',

    'объявить': 'оголосити',
    'объявляет': 'оголошує',
    'объявляют': 'оголошують',

    'заключить': 'укласти',
    'заключает': 'укладає',
    'заключают': 'укладають',

    'присоединить': 'приєднати',
    'присоединяет': 'приєднує',
    'присоединяют': 'приєднують',

    'потерять': 'втратити',
    'теряет': 'втрачає',
    'теряют': 'втрачають',

    'увеличить': 'збільшити',
    'увеличивает': 'збільшує',
    'увеличивают': 'збільшують',

    'уменьшить': 'зменшити',
    'уменьшает': 'зменшує',
    'уменьшают': 'зменшують',

    'изменить': 'змінити',
    'изменяет': 'змінює',
    'изменяют': 'змінюють',

    'создать': 'створити',
    'создает': 'створює',
    'создают': 'створюють',

    'удалить': 'видалити',
    'удаляет': 'видаляє',
    'удаляют': 'видаляють',

    'добавить': 'додати',
    'добавляет': 'додає',
    'добавляют': 'додають',

    # Технічні терміни
    'модификатор': 'модифікатор',
    'модификатора': 'модифікатора',
    'модификатору': 'модифікатору',
    'модификатором': 'модифікатором',
    'модификаторы': 'модифікатори',
    'модификаторов': 'модифікаторів',

    'эффект': 'ефект',
    'эффекта': 'ефекту',
    'эффекту': 'ефекту',
    'эффектом': 'ефектом',
    'эффекты': 'ефекти',
    'эффектов': 'ефектів',

    'событие': 'подія',
    'события': 'події',
    'событию': 'події',
    'событием': 'подією',
    'событий': 'подій',

    'миссия': 'місія',
    'миссии': 'місії',
    'миссию': 'місію',
    'миссией': 'місією',
    'миссий': 'місій',

    'технология': 'технологія',
    'технологии': 'технології',
    'технологию': 'технологію',
    'технологией': 'технологією',
    'технологий': 'технологій',

    'институт': 'інституція',
    'института': 'інституції',
    'институту': 'інституції',
    'институтом': 'інституцією',
    'институты': 'інституції',
    'институтов': 'інституцій',

    'закон': 'закон',
    'закона': 'закону',
    'закону': 'закону',
    'законом': 'законом',
    'законы': 'закони',
    'законов': 'законів',

    'политика': 'політика',
    'политики': 'політики',
    'политику': 'політику',
    'политикой': 'політикою',
    'политик': 'політик',

    'идея': 'ідея',
    'идеи': 'ідеї',
    'идею': 'ідею',
    'идеей': 'ідеєю',
    'идей': 'ідей',

    'советник': 'радник',
    'советника': 'радника',
    'советнику': 'раднику',
    'советником': 'радником',
    'советники': 'радники',
    'советников': 'радників',

    'династия': 'династія',
    'династии': 'династії',
    'династию': 'династію',
    'династией': 'династією',
    'династий': 'династій',

    'сословие': 'стан',
    'сословия': 'стану',
    'сословию': 'стану',
    'сословием': 'станом',
    'сословия': 'стани',
    'сословий': 'станів',

    'повстанец': 'повстанець',
    'повстанца': 'повстанця',
    'повстанцу': 'повстанцю',
    'повстанцом': 'повстанцем',
    'повстанцы': 'повстанці',
    'повстанцев': 'повстанців',

    'колония': 'колонія',
    'колонии': 'колонії',
    'колонию': 'колонію',
    'колонией': 'колонією',
    'колоний': 'колоній',

    'союз': 'союз',
    'союза': 'союзу',
    'союзу': 'союзу',
    'союзом': 'союзом',
    'союзы': 'союзи',
    'союзов': 'союзів',

    'соперник': 'суперник',
    'соперника': 'суперника',
    'сопернику': 'супернику',
    'соперником': 'суперником',
    'соперники': 'суперники',
    'соперников': 'суперників',

    'враг': 'ворог',
    'врага': 'ворога',
    'врагу': 'ворогу',
    'врагом': 'ворогом',
    'враги': 'вороги',
    'врагов': 'ворогів',

    'сосед': 'сусід',
    'соседа': 'сусіда',
    'соседу': 'сусіду',
    'соседом': 'сусідом',
    'соседи': 'сусіди',
    'соседей': 'сусідів',

    'товар': 'товар',
    'товара': 'товару',
    'товару': 'товару',
    'товаром': 'товаром',
    'товары': 'товари',
    'товаров': 'товарів',

    'ресурс': 'ресурс',
    'ресурса': 'ресурсу',
    'ресурсу': 'ресурсу',
    'ресурсом': 'ресурсом',
    'ресурсы': 'ресурси',
    'ресурсов': 'ресурсів',

    # Додаткові фрази
    'в течение': 'протягом',
    'в случае': 'у випадку',
    'из-за': 'через',
    'несмотря на': 'незважаючи на',
    'вместо': 'замість',
    'против': 'проти',
    'между': 'між',
    'среди': 'серед',
    'вокруг': 'навколо',
    'около': 'близько',
    'после': 'після',
    'перед': 'перед',
    'при': 'при',
    'без': 'без',
    'для': 'для',
    'до': 'до',
    'от': 'від',
    'из': 'з',
    'на': 'на',
    'в': 'в',
    'с': 'з',
    'за': 'за',
    'над': 'над',
    'под': 'під',
    'по': 'по',
    'у': 'у',

    # Заміна російських "ё" та інших специфічних символів
    'ё': 'є',
    'Ё': 'Є',
}

def translate_text(text):
    """Переклад тексту з російської на українську"""
    if not text or not isinstance(text, str):
        return text

    # Пропускаємо технічні рядки
    if text.startswith('[') and text.endswith(']'):
        return text
    if text.startswith('$') or text.startswith('#'):
        return text

    result = text

    # Застосовуємо словник (від довших до коротших для точності)
    sorted_keys = sorted(TRANSLATION_DICT.keys(), key=len, reverse=True)
    for ru_word, ua_word in [(k, TRANSLATION_DICT[k]) for k in sorted_keys]:
        # Цілі слова (з межами слів)
        pattern = r'\b' + re.escape(ru_word) + r'\b'
        result = re.sub(pattern, ua_word, result, flags=re.IGNORECASE)

    return result

def translate_file(russian_file, ukrainian_file):
    """Переклад одного файлу"""
    print(f"\n{'='*70}")
    print(f"Перекладаю: {russian_file.name}")
    print(f"→ {ukrainian_file.name}")
    print('='*70)

    try:
        # Читаємо російський файл
        with open(russian_file, 'r', encoding='utf-8-sig') as f:
            lines = f.readlines()

        translated_lines = []
        stats = {'total': 0, 'translated': 0, 'skipped': 0}

        for i, line in enumerate(lines, 1):
            stats['total'] += 1

            # Перший рядок (l_russian:) → l_english:
            if i == 1 and 'l_russian' in line:
                translated_lines.append('l_english:\n')
                stats['translated'] += 1
                continue

            # Пропускаємо коментарі та порожні рядки
            if line.strip().startswith('#') or not line.strip():
                translated_lines.append(line)
                stats['skipped'] += 1
                continue

            # YAML рядок: ключ: "значення"
            match = re.match(r'^(\s*)([^:]+):\s*"(.*)"\s*$', line)
            if match:
                indent, key, value = match.groups()

                # Перекладаємо значення
                translated_value = translate_text(value)

                # Зберігаємо результат
                translated_lines.append(f'{indent}{key}: "{translated_value}"\n')
                stats['translated'] += 1
            else:
                # Якщо формат інший - залишаємо як є
                translated_lines.append(line)
                stats['skipped'] += 1

        # Зберігаємо перекладений файл
        with open(ukrainian_file, 'w', encoding='utf-8-sig') as f:
            f.writelines(translated_lines)

        print(f"✓ Завершено!")
        print(f"  Всього рядків: {stats['total']}")
        print(f"  Перекладено: {stats['translated']}")
        print(f"  Пропущено: {stats['skipped']}")
        print(f"  Збережено: {ukrainian_file}")

        return stats

    except Exception as e:
        print(f"✗ ПОМИЛКА: {e}")
        return {'total': 0, 'translated': 0, 'skipped': 0}

def main():
    base_dir = Path("/Users/furmonenko/Desktop/eu5-ukrainian-localization")
    russian_dir = base_dir / "reference" / "russian"
    ukrainian_dir = base_dir / "main_menu" / "localization" / "english"

    # Файли для перекладу
    files_to_translate = [
        'triggers_l_russian.yml',
        'advances_l_russian.yml',
        'diplomacy_l_russian.yml',
        'laws_and_policies_l_russian.yml',
        'units_l_russian.yml',
    ]

    print("╔" + "="*68 + "╗")
    print("║" + " "*15 + "АВТОМАТИЗОВАНИЙ ПЕРЕКЛАД ТОП-5 ФАЙЛІВ" + " "*15 + "║")
    print("╚" + "="*68 + "╝")

    total_stats = {'total': 0, 'translated': 0, 'skipped': 0}

    for russian_filename in files_to_translate:
        ukrainian_filename = russian_filename.replace('_russian', '_english')

        russian_file = russian_dir / russian_filename
        ukrainian_file = ukrainian_dir / ukrainian_filename

        if not russian_file.exists():
            print(f"\n⚠️  Файл не знайдено: {russian_file}")
            continue

        # Перекладаємо файл
        stats = translate_file(russian_file, ukrainian_file)

        # Оновлюємо загальну статистику
        for key in total_stats:
            total_stats[key] += stats[key]

    # Фінальний звіт
    print("\n" + "╔" + "="*68 + "╗")
    print("║" + " "*25 + "ПІДСУМОК" + " "*36 + "║")
    print("╚" + "="*68 + "╝")
    print(f"\nВсього оброблено рядків: {total_stats['total']}")
    print(f"Перекладено: {total_stats['translated']}")
    print(f"Пропущено (коментарі/порожні): {total_stats['skipped']}")
    print(f"\n✓ Всі 5 файлів перекладено!")
    print(f"\nФайли збережено в: {ukrainian_dir}")

if __name__ == "__main__":
    main()
